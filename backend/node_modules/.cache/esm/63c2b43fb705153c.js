let Database,create,all,setUpError;_b70‍.x([["checkDb",()=>checkDb],["addPriceVol",()=>addPriceVol],["createIndex",()=>createIndex]]);_b70‍.w("better-sqlite3",[["default",["Database"],function(v){Database=v}]]);_b70‍.w("mathjs",[["create",["create"],function(v){create=v}],["all",["all"],function(v){all=v}]]);_b70‍.w("./error",[["setUpError",["setUpError"],function(v){setUpError=v}]]);



// create a mathjs instance
const math = create(all)

// checks if that database exists
       function checkDb (path) { 
    try { 
        return new Database(path,{fileMustExist:true}); 
    }
    catch(err) { 
        throw new setUpError("Database file not found - make sure database 'sws.sqlite3' in src");
    }
};

// this function will calculate and return an object with the price volatilities of the stocks
       function addPriceVol (rows){
    // extract the historial price data
    const histPrices = {};

    rows.map(row => {
        if (!histPrices[row.company_id]) {
            histPrices[row.company_id] = [];
        }
        histPrices[row.company_id].push(row.price);
        }
    );

    // calulate normalised price volatility using std/mean as measure
    const zscores = {};
    //calc normalised stds 
    for(const company_id in histPrices) {
        zscores[company_id] = math.std(histPrices[company_id])/math.mean(histPrices[company_id]);
    }
    return zscores;
}

// function formats SQL index query
       function createIndex (indexName, tableName, indexOn) {
    return `CREATE INDEX IF NOT EXISTS ${indexName} ON ${tableName} (${indexOn});`;
}